<!-- <!DOCTYPE html> -->
<meta charset="utf-8">
<head>
  <title>Force layout (foci)</title>
  <link rel="preload" href="/data/graph.json" as="prefetch">
</head>

<style>
</style>

<body>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.2.2/d3.min.js"></script>

  <script>

// var nodes = {
//   'App': {name: 'App', depth: 0, x:100, y:100, radius:35, type:'container'},
//   'Nav': {name: 'Nav', depth: 1, x:100, y:100, radius:30, type:'component'},
//   'Main': {name: 'Main', depth: 1, x:100, y:100, radius:30, type:'container'},
//   'Menu': {name: 'Menu', depth: 2, x:100, y:100, radius:30, type:'component'},
//   'Router': {name: 'Router', depth: 2, x:100, y:100, radius:30, type:'component'},
//   'OverView': {name: 'OverView', depth: 3, x:100, y:100, radius:30, type:'component'},
//   'MainView': {name: 'MainView', depth: 3, x:100, y:100, radius:30, type:'component'},
//   'MiddleView': {name: 'MiddleView', depth: 3, x:100, y:100, radius:30, type:'container'},
// }
//
// var links = [
//   {source: nodes['App'], target: nodes['Nav']},
//   {source: nodes['App'], target: nodes['Main']},
//   {source: nodes['Nav'], target: nodes['Menu']},
//   {source: nodes['Main'], target: nodes['Router']},
//   {source: nodes['Router'], target: nodes['OverView']},
//   {source: nodes['Router'], target: nodes['MainView']},
//   {source: nodes['Router'], target: nodes['MiddleView']},
// ]
//
// function getChildren(node) {
//   var myLinks = links.filter(obj => obj.source === node)
//   var children = myLinks.map(link => link.target)
//   return children
// }

var treeData =
{
  "name": "App",
  "type": "component",
  "children": [
    {
      "name": "Haeder",
      "type": "component",
      "children": [
           {
              "name": "Something",
              "type": "component",
              "children": [
                {
                  "name": "SomeSubThing",
                  "type": "component",
                }
              ]
            },
            {
              "name": "Button",
              "type": "component",
            }
          ]

    },
    {
      "name": "Navigation",
      "type": "component",
      "children":[{
        "name": "NaviData",
        "type": "container",
        "children": [
          {
            "name": "Logo",
            "type": "component",
          },
          {
            "name": "Menue",
            "type": "component",
          }
        ]
      }
    ]
    },
    {
      "name": "Main",
      "type": "container",
      "children": [
           {
              "name": "Something",
              "type": "component",
              "children": [
                {
                  "name": "SomeSubThing",
                  "type": "component",
                }
              ]
            },
            {
              "name": "Button",
              "type": "component",
            }
          ]
    },
  ]
}

//var width = 600, height = 400;

var colorScale = ['orange', 'lightblue', '#B19CD9'];
//var xCenter = [100, 300, 500]
var forceYByLevelValues = [50,150,250,350]

// set the dimensions and margins of the diagram
var margin = {top: 40, right: 90, bottom: 50, left: 90},
    width = 660 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

var treemap = d3.tree()
    .size([width, height]);

var nodesHierarchy = d3.hierarchy(treeData)
var nodes = treemap(nodesHierarchy)
var links = nodesHierarchy.links()

var simulation = d3.forceSimulation(nodes)
  .force('charge', d3.forceManyBody().strength(-80))
  .force('y', d3.forceY().strength(200).y(height/2))
  .force('collision', d3.forceCollide().radius(function(d) {
    return d.radius;
  }))
  .on('tick', ticked);

var svg =  d3.select("body").append("svg")
  .attr("width", width + margin.left + margin.right)
  .attr("height", height + margin.top + margin.bottom)
  //
var g = svg.append("g")
  .attr("transform", "translate(" + margin.left + "," + margin.top + ")")

function ticked() {
  var node = svg.select('g').selectAll('.node')
      .data(nodes.descendants())
    .enter().append("g")
      .attr("transform", function(d) {
        return "translate(" + d.x + "," + d.y + ")";
      })
      .attr("class", function(d) {
        return "node" +
          (d.children ? " node--internal" : " node--leaf"); })

  node.append("circle")
    .attr("r", 10)
    .attr("style",function(d){
      // http://www.color-hex.com/color-palette/53835
      var color = d.data.type==="container"?"#b4e2f4":"#f9eeb8"
      return "fill:"+color+"; stroke:darkgrey; stroke-width:3"
    })
  g.selectAll(".node").call(d3.drag()
      .on("start", dragstarted)
      .on("drag", dragged)
      .on("end", dragended))

  //https://bl.ocks.org/d3noob/204d08d309d2b2903e12554b0aef6a4d
  function dragstarted(d) {
    d.fx = d3.event.x;
    d.fy = d3.event.y;
    d3.select(this).raise().classed("active", true);
  }

  function dragged(d) {
    d.fx = d3.event.x;
    d.fy = d3.event.y;
    d3.select(this)
      .attr("transform", function(d) {
        return "translate(" + d3.event.x + "," + d3.event.y + ")";
      })
    var links = g.selectAll("line.link")
  }

  function dragended(d) {
    d.fx = null;
    d.fy = null;
    d3.select(this).classed("active", false);
  }


  // adds the text to the node
  node.append("text")
    .attr("dy", ".35em")
    .attr("y", function(d) { return d.children ? -20 : 20; })
    .style("text-anchor", "middle")
    .text(function(d) { return d.data.name; });
}
  </script>
</body>
</html>
